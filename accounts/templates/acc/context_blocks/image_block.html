{% load static %}

<div class="row mb-4">
    <label class="col-sm-2 col-form-label">Avatar</label>
    <div class="col-sm-10">
        <div class="mb-3 d-flex align-items-center gap-3">
            {% if user.avatar and not for_registration %}
                <img src="/media/{{ user.avatar }}"
                     id="avatarPreview"
                     alt="Current Avatar"
                     class="rounded-circle border"
                     style="width: 80px; height: 80px; object-fit: cover;">
                <div class="form-text">Текущее изображение</div>
            {% else %}
                <img src="{% static 'img/avatarka.png' %}"
                     id="avatarPreview"
                     alt="Current Avatar"
                     class="rounded-circle border"
                     style="width: 80px; height: 80px; object-fit: cover;">
                <div class="form-text">{% if for_registration %}Предпросмотр{% else %}Изображение по умолчанию{% endif %}</div>
            {% endif %}
        </div>

        <div class="input-group">
            <input type="file" name="avatar"
                   class="form-control {% if avatar_error %}is-invalid{% endif %}"
                   id="avatarUpload"
                   accept="image/*">
            {% if avatar_error %}
                <div class="invalid-feedback">{{ avatar_error }}</div>
            {% endif %}
        </div>
        <div class="form-text">Максимум 5MB. Разрешены JPG, PNG, GIF</div>
    </div>
</div>

<script>
    // Скрипт для предпросмотра выбранного аватара
    document.addEventListener('DOMContentLoaded', function() {
        const upload = document.getElementById('avatarUpload');
        const preview = document.getElementById('avatarPreview');

        if (upload && preview) {
            upload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
    });
</script>